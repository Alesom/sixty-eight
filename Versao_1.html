<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Alesom Games</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.CANVAS, '', { preload: preload, create: create, update: update });


function preload() {
    game.load.image('sky', 'assets/Fundo4.png');
	game.load.image('city', 'assets/City4.png');
	game.load.image('morreu', 'assets/Morreu.png');
	game.load.image('chao', 'assets/Ground2.png');
    game.load.image('ground', 'assets/platform.png');
    game.load.image('star', 'assets/star.png');
    game.load.spritesheet('Jhosua', 'assets/Qua10.png', 100, 87,9);
	game.load.spritesheet('Bar_ini', 'assets/Baratas_ini6.png', 160, 39,4);
	game.load.image('bullet', 'assets/bala2.png');
	game.load.image('NovoJogo', 'assets/LetrasB2.png');
	game.load.image('plataformaPredio1','assets/PlataformaPredio11.png');
	game.load.image('plataformaPredio2','assets/PlataformaPredio21.png');
	game.load.image('plataformaPredio3','assets/PlataformaPredio31.png');
	game.load.image('plataformaPredio4','assets/PlataformaPredio41.png');
	game.load.image('plataformaPredio5','assets/PlataformaPredio51.png');
	game.load.image('plataformaPredio6','assets/PlataformaPredio62.png');
	game.load.image('chave', 'assets/Chave.png');
	game.load.image('porta', 'assets/TheDoors2.png');
}


var player;
var ini;
var platforms;
var cursors;
var ponteiroParaTiro = 0;
var inimigos;
var backgroundTown;
var criaPlayer_bool=true;

//var segundos=0;


var stars;
var score = 0;
var scoreText;

var bullets;//happen
var bulletTime = 0;//happen
var fireButton;//happen
//var diamante;
var NovoJogo;
var morreu;
var chave;
var pegouChave=false;
var contadorIni=20;
var portas;


function create() {

    //  A simple background for our game
    //game.add.sprite(0, 0, 'sky');
	backgroundTown = game.add.tileSprite(0, 0, 3200, 2048, 'sky');
	
	game.world.setBounds(0, 0, 3200, 2048);
	game.add.sprite(0,-109,'city');
	
    //  The platforms group contains the ground and the 2 ledges we can jump on
    platforms = game.add.group();
	
    // Here we create the ground.
    var ground = platforms.create(0, game.world.height - 200, 'chao');
	
    //  Scale it to fit the width of the game (the original sprite is 400x32 in size)
    ground.scale.setTo(2, 2);

    //  This stops it from falling away when you jump on it
    ground.body.immovable = true;
	
	portas = game.add.group();
	//portas.body.immovable=true;
	
	var ground2 = platforms.create(2,1066+10, 'plataformaPredio1');
    ground2.scale.setTo(2, 2);
	ground2.body.immovable = true;
	
	var porta1 = portas.create(168, game.world.height - 317, 'porta');
	porta1.body.immovable=true;
	
	var ground3 = platforms.create(492,321+10, 'plataformaPredio2');
	ground3.body.immovable = true;
	ground3.scale.setTo(2, 2);
	
	var porta2 = portas.create (664, game.world.height - 317, 'porta');
	porta2.body.immovable=true;
	
	var ground4 = platforms.create(1004,1249+10, 'plataformaPredio3');
    ground4.scale.setTo(2, 2);
	ground4.body.immovable = true;
	
	var porta3 = portas.create (1180, game.world.height - 317, 'porta');
	porta3.body.immovable=true;
	
	var ground5 = platforms.create(1955,605+10, 'plataformaPredio4');
    ground5.scale.setTo(2, 2);
	ground5.body.immovable = true;
	
	var porta4 = portas.create (2106, game.world.height - 317, 'porta');
	porta4.body.immovable=true;
	
	var ground6 = platforms.create(2378,1249+10, 'plataformaPredio5');
    ground6.scale.setTo(2, 2);
	ground6.body.immovable = true;
	
	var ground7 = platforms.create(2720,330-1600+10, 'plataformaPredio6');
    ground7.scale.setTo(2, 2);
	ground7.body.immovable = true;
	
	criaChave();
	
	bullets = game.add.group();//happen
    bullets.createMultiple(30, 'bullet');//happen
    bullets.setAll('anchor.x', 0.5);//0.5//happen
    bullets.setAll('anchor.y', 0.5);//1//happen	
    bullets.setAll('outOfBoundsKill', true);//happen
	
	
	//var ledge = platforms.create(400, 400, 'ground');
    //ledge.body.immovable = true;

    //ledge = platforms.create(-150, 250, 'ground');
    //ledge.body.immovable = true;
		
	// The player and its settings
	if (criaPlayer_bool==true){
		criaPlayer();
	}
	//player = game.add.sprite(200, 200, 'Jhosua');
	//ini = game.add.sprite(60, 0,'Bar_ini');
	//ini.body.gravity.y=6;
	//ini.body.collideWorldBounds = true;
	
/*	player.anchor.setTo(0.5, 0.5);//happen
	
    //  Player physics properties. Give the little guy a slight bounce.
    player.body.bounce.y = 0.2;
    player.body.gravity.y = 6;
    player.body.collideWorldBounds = true;
	*/
	inimigos= game.add.group();
	criaIni();
	/*for (var i1 = 0; i1 < 2; i1++){
		var ini = inimigos.create(0,i1*400,'Bar_ini');
		ini.body.gravity.y=6;
		//ini.body.collideWorldBounds = true;
		ini.animations.add('left_ini', [0, 1], 8, true);
		ini.animations.add('right_ini', [2, 3], 8, true);
		ini.play('right_ini');
		ini.body.velocity.x=60;
	}*/
	
	
	
	//PAREI AQUI 
	
	
	//  Our two animations, walking left and right.
  //  player.animations.add('left', [0, 1, 2, 3], 10, true);
   // player.animations.add('right', [5, 6, 7, 8], 10, true);

    //  Finally some stars to collect
    stars = game.add.group();
	
	
	//  Here we'll create 12 of them evenly spaced apart
    for (var i = 0; i < 122; i++){
        //  Create a star inside of the 'stars' group
        var star = stars.create(i * 70, 0, 'star');

        //  Let gravity do its thing
        star.body.gravity.y = 6;

        //  This just gives each star a slightly random bounce value
        star.body.bounce.y = 0.7 + Math.random() * 0.2;
    }
	
    //  Our controls.
    cursors = game.input.keyboard.createCursorKeys();
    fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
	
//	game.camera.follow(player);
	
	NovoJogo= game.add.sprite(300, 320, 'NovoJogo');
	NovoJogo.fixedToCamera=true;
	NovoJogo.cameraOffset.x=450;
    NovoJogo.cameraOffset.y=300;
	NovoJogo.visible=false;
    NovoJogo.inputEnabled=true;
	
//	game.time.events.loop(Phaser.Timer.SECOND, updateCounter, this);
}
function update() {

    //  Collide the player and the stars with the platforms
   //	 backgroundTown.tilePosition.x+=2;
	
	game.physics.collide(player, platforms);
    game.physics.collide(stars, platforms);
	game.physics.collide(inimigos, platforms);
    //  Checks to see if the player overlaps with any of the stars, if he does call the collectStar function
    game.physics.overlap(player, stars, collectStar, null, this);

    //  Reset the players velocity (movement)
    player.body.velocity.x = 0;
	//ini.body.velocity.x=150;
	//ini.animations.play('left');
	
	if (cursors.left.isDown){
		//  Move to the left
		player.body.velocity.x = -150;
		player.animations.play('left');
		ponteiroParaTiro=1;
	//	segundos++;
	}else if (cursors.right.isDown){
		//  Move to the right
		player.body.velocity.x = 150;
		player.animations.play('right');
		ponteiroParaTiro=2;
	//	segundos++;
	}else{
		//  Stand still
		player.animations.stop();
		player.frame = 4;
		ponteiroParaTiro=0;
		//segundos++;
	}
	if (fireButton.isDown && ponteiroParaTiro!=0){
        fireBullet(ponteiroParaTiro);
    }
	//  Allow the player to jump if they are touching the ground.
	if (cursors.up.isDown && player.body.touching.down){
		player.body.velocity.y = -1200;//altura do pulo
	}
	for(var i=0; i < contadorIni; i++){//novo 
		if (inimigos.getAt(i)){
			switch (i){
				case 0:
					if (inimigos.getAt(i).body.x>300){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}else if (inimigos.getAt(i).body.x<10){
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}
					break;
				case 1:
					if (inimigos.getAt(i).body.x>720){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}else if (inimigos.getAt(i).body.x<495){
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}
					break;
				case 2:
					if (inimigos.getAt(i).body.x>1300){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}else if (inimigos.getAt(i).body.x<1004){
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}
					break;
				case 3: 
					if (inimigos.getAt(i).body.x>2200){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}else if (inimigos.getAt(i).body.x<1950){
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}
					break;
				case 4:
					if (inimigos.getAt(i).body.x>2520){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}else if (inimigos.getAt(i).body.x<2368){
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}
					break;
					
					//segundo bloco
				case 5:
					if (inimigos.getAt(i).body.x<10){//300
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}else if (inimigos.getAt(i).body.x>300){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}
					break;
				case 6:
					if (inimigos.getAt(i).body.x<495){//720
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}else if (inimigos.getAt(i).body.x>720){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}
					break;
				case 7:
					if (inimigos.getAt(i).body.x<1004){//1300
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}else if (inimigos.getAt(i).body.x>1300){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}
					break;
				case 8: 
					if (inimigos.getAt(i).body.x<1950){//2200
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}else if (inimigos.getAt(i).body.x>2200){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}
					break;
				case 9:
					if (inimigos.getAt(i).body.x<2368){//2520
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}else if (inimigos.getAt(i).body.x>2520){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}
					break;
				default:
					if (inimigos.getAt(i).body.x<0 || inimigos.getAt(i).body.x> game.world.width-150){
						inimigos.getAt(i).body.x=game.world.randomX;//here
						inimigos.getAt(i).body.y=game.world.randomY;
					//	if ((Math.random()%2)==0){
				//			ini.play('left_ini');
				//			ini.body.velocity.x=-60;
				//		}else{
			///				ini.play('right_ini');
			//				ini.body.velocity.x=60;
				//		}
					}
					break;
				}
		}
	}//end novo
	if (NovoJogo.visible){
		NovoJogo.events.onInputDown.add(restart,this);
	}
//	game.physics.overlap(inimigos, player, KillPlayer, null, this); ARRUMAR DPS!
	game.physics.overlap(chave, player, getChave, null, this);
	game.physics.overlap(inimigos, bullets, KillInimi, null, this);
	
//	game.time.events.loop(Phaser.Timer.SECOND, updateCounter, this);
//	if ((segundos%4597)==0){
//		updateCounter();
//	}
}

/*function updateCounter(){
	//segundos++;
	//alert('clicked');
	//if ((segundos%23)==0){
		contadorIni++;
		var ini = inimigos.create(/*game.world.randomX, game.world.randomY0,0,'Bar_ini');
		ini.body.gravity.y=6;
		ini.body.collideWorldBounds = false;
		ini.animations.add('left_ini', [0, 1], 8, true);
		ini.animations.add('right_ini', [2, 3], 8, true);
		ini.play('right_ini');
		ini.body.velocity.x=60;
	//}
}*/


	
function criaChave(){
	chave=game.add.sprite(200,400,'chave');
	chave.scale.setTo(0.2,0.2);
}

function getChave (chave, player){
	chave.kill();
	pegouChave=true;
}
function KillPlayer(player, inimigo){
	//inimigo.kill();
	criaPlayer_bool=false;
	player.kill();
	NovoJogo.visible = true;
	var x=player.body.x;
	var y=player.body.y;
	morreu= game.add.sprite(x, y+20, 'morreu');
	morreu.body.velocity.y=-155;
	game.input.onTap.addOnce(restart,this);	
}

function KillInimi(inimigo, bullet){
	inimigo.kill();
	bullet.kill();
}

function collectStar (player, star) {
      star.kill();
}

function fireBullet (ponteiroParaTiro) {

    //  To avoid them being allowed to fire too fast we set a time limit
    if (game.time.now > bulletTime){
        //  Grab the first bullet we can from the pool
        bullet = bullets.getFirstExists(false);

        if (bullet){
            //  And fire it
            if (ponteiroParaTiro==1){
				bullet.reset(player.x-60, player.y+8);//isso é a salvação! :D
				bullet.body.velocity.x = -400;
            }else if (ponteiroParaTiro==2){
				bullet.reset(player.x+60, player.y+8);//isso é a salvação! :D
				bullet.body.velocity.x = +400;
			}
            bulletTime = game.time.now + 200;
        }
    }
}

function criaPlayer(){
	player = game.add.sprite(2320, 500, 'Jhosua');
	player.anchor.setTo(0.5, 0.5);
    player.body.bounce.y = 0.2;
    player.body.gravity.y = 6;
    player.body.collideWorldBounds = true;
	player.animations.add('left', [0, 1, 2, 3], 10, true);
    player.animations.add('right', [5, 6, 7, 8], 10, true);
	game.camera.follow(player);
}

function resetBullet (bullet) {
    bullet.kill();
}

function criaIni(){
	for (var i1 = 0; i1 < contadorIni; i1++){
			switch (i1){
				case 0:
					var ini = inimigos.create(2,1066-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('right_ini');
					ini.body.velocity.x=60;
					break;
				case 1:
					var ini = inimigos.create(492,325-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('right_ini');
					ini.body.velocity.x=60;
					break;
				case 2:
					var ini = inimigos.create(1004,1249-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('right_ini');
					ini.body.velocity.x=60;
					break;
				case 3:
					var ini = inimigos.create(1900,605-100,'Bar_ini');
					ini.body.gravity.y = 6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('right_ini');
					ini.body.velocity.x=60;
					break;
				case 4:
					var ini = inimigos.create(2378,1249-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('right_ini');
					ini.body.velocity.x=60;
					break;
					
					//segundo bloco
				case 5:
					var ini = inimigos.create(300,1066-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('left_ini');
					ini.body.velocity.x=-60;
					break;
				case 6:
					var ini = inimigos.create(720,325-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('left_ini');
					ini.body.velocity.x=-60;
					break;
				case 7:
					var ini = inimigos.create(1300,1249-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('left_ini');
					ini.body.velocity.x=-60;
					break;
				case 8:
					var ini = inimigos.create(2250,605-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('left_ini');
					ini.body.velocity.x=-60;
					break;
				case 9:
					var ini = inimigos.create(2520,1249-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('left_ini');
					ini.body.velocity.x=-60;
					break;
				default:
					var ini = inimigos.create(game.world.randomX,game.world.randomY,'Bar_ini');//here
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = false;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					if ((game.world.randomX%2)==0){
						ini.play('left_ini');
						ini.body.velocity.x=-60;
					}else{
						ini.play('right_ini');
						ini.body.velocity.x=60;
					}
					break;
		}
	}
}


function restart () {
    //revives the player
	//morreu.visible=false;
	
	morreu.kill();
	inimigos.removeAll();
	criaIni();
	if (criaPlayer_bool==false){
		criaPlayer();
	}
	criaPlayer_bool=true;
	//alert('Reniciar?');
	//player.kill(); //já morreu.
    //inimigos.callAll().kill();
    //inimigos.removeAll();
	chave.kill();
	criaChave();
	pegouChave=false;
//	player.revive();
	NovoJogo.visible = false;
}


//function resetBar_ini (Bar_ini) {

    //  Called if the bullet goes out of the screen
  //  Bar_ini.kill();

//}


</script>

</body>
</html>