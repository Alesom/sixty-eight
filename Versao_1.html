<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Alesom Games</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.CANVAS, '', { preload: preload, create: create, update: update });


function preload() {
    game.load.image('sky', 'assets/Fundo4.png');
	game.load.image('city', 'assets/City4.png');
	game.load.image('morreu', 'assets/Morreu.png');
	game.load.image('chao', 'assets/Ground2.png');
    game.load.image('ground', 'assets/platform.png');
    game.load.image('star', 'assets/star.png');
    game.load.spritesheet('Jhosua', 'assets/Qua10.png', 100, 87,9);
	game.load.spritesheet('Bar_ini', 'assets/Baratas_ini6.png', 160, 39,4);
	game.load.image('bullet', 'assets/bala2.png');
	game.load.image('NovoJogo', 'assets/LetrasB2.png');
	game.load.image('plataformaPredio1','assets/PlataformaPredio11.png');
	game.load.image('plataformaPredio2','assets/PlataformaPredio21.png');
	game.load.image('plataformaPredio3','assets/PlataformaPredio31.png');
	game.load.image('plataformaPredio4','assets/PlataformaPredio41.png');
	game.load.image('plataformaPredio5','assets/PlataformaPredio51.png');
	game.load.image('plataformaPredio6','assets/PlataformaPredio62.png');
	game.load.image('chave', 'assets/Chave.png');
	game.load.image('porta', 'assets/TheDoors2.png');
	//game.load.image('dia', 'assets/diamond.png');
	game.load.image('pote', 'assets/pote.png');
	
}


var player;
var ini;
var platforms;
var cursors;
var ponteiroParaTiro = 0;
var inimigos;
var backgroundTown;
var criaPlayer_bool=true;

//var segundos=0;

var clickSingle=true;
var stars;
var score = 0;
var scoreText;

var bullets;//happen
var bulletTime = 0;//happen
var fireButton;//happen
//var diamante;
var NovoJogo;
var morreu;
var chave;
var pegouChave=false;
var contadorIni=20;
var portas;

var varbool=false;
var premios;
var premio1=false;
var premio2=false;
var premio3=false;
var premio4=false;


function create() {

    backgroundTown = game.add.tileSprite(0, 0, 3200, 2048, 'sky');
	
	game.world.setBounds(0, 0, 3200, 2048);
	game.add.sprite(0,-109,'city');
	
    platforms = game.add.group();
	
    var ground = platforms.create(0, game.world.height - 200, 'chao');
	
    ground.scale.setTo(2, 2);

    ground.body.immovable = true;
	
	portas = game.add.group();
	
	var ground2 = platforms.create(2,1066+10, 'plataformaPredio1');
    ground2.scale.setTo(2, 2);
	ground2.body.immovable = true;
	
	var porta1 = portas.create(168, game.world.height - 317, 'porta');
	porta1.body.immovable=true;
	
	var ground3 = platforms.create(492,321+10, 'plataformaPredio2');
	ground3.body.immovable = true;
	ground3.scale.setTo(2, 2);
	
	var porta2 = portas.create (664, game.world.height - 317, 'porta');
	porta2.body.immovable=true;
	
	var ground4 = platforms.create(1004,1249+10, 'plataformaPredio3');
    ground4.scale.setTo(2, 2);
	ground4.body.immovable = true;
	
	var porta3 = portas.create (1180, game.world.height - 317, 'porta');
	porta3.body.immovable=true;
	
	var ground5 = platforms.create(1955,605+10, 'plataformaPredio4');
    ground5.scale.setTo(2, 2);
	ground5.body.immovable = true;
	
	var porta4 = portas.create (2106, game.world.height - 317, 'porta');
	porta4.body.immovable=true;
	
	var ground6 = platforms.create(2378,1249+10, 'plataformaPredio5');
    ground6.scale.setTo(2, 2);
	ground6.body.immovable = true;
	
	var ground7 = platforms.create(2720,-1260, 'plataformaPredio6');
    ground7.scale.setTo(2, 2);
	ground7.body.immovable = true;
	
	var porta7 = portas.create (2700, 860, 'porta');
	porta4.body.immovable=true;
	
	premios=game.add.group();
//	criaPremios();
	criaChave();
	
	bullets = game.add.group();//happen
    bullets.createMultiple(30, 'bullet');//happen
    bullets.setAll('anchor.x', 0.5);//0.5//happen
    bullets.setAll('anchor.y', 0.5);//1//happen	
    bullets.setAll('outOfBoundsKill', true);//happen
	

	if (criaPlayer_bool==true){
		criaPlayer();
	}

	inimigos= game.add.group();
	criaIni();
	
    stars = game.add.group();
	
    for (var i = 0; i < 122; i++){
   
        var star = stars.create(i * 70, 0, 'star');

       
        star.body.gravity.y = 6;

        star.body.bounce.y = 0.7 + Math.random() * 0.2;
    }
	

    cursors = game.input.keyboard.createCursorKeys();
    fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
	
	NovoJogo= game.add.sprite(300, 320, 'NovoJogo');
	NovoJogo.fixedToCamera=true;
	NovoJogo.cameraOffset.x=450;
    NovoJogo.cameraOffset.y=300;
	NovoJogo.visible=false;
    NovoJogo.inputEnabled=true;
	
}
function update() {

	game.physics.collide(player, platforms);
    game.physics.collide(stars, platforms);
	game.physics.collide(inimigos, platforms);
    game.physics.overlap(player, stars, collectStar, null, this);
	
	
    player.body.velocity.x = 0;
	
	if (cursors.left.isDown){
		player.body.velocity.x = -150;
		player.animations.play('left');
		ponteiroParaTiro=1;
		clickSingle=true;
	}else if (cursors.right.isDown){
		player.body.velocity.x = 150;
		player.animations.play('right');
		ponteiroParaTiro=2;
		clickSingle=true;
	}else{
		player.animations.stop();
		player.frame = 4;
		ponteiroParaTiro=0;
	}
	if (fireButton.isDown && ponteiroParaTiro!=0){
        fireBullet(ponteiroParaTiro);
    }
	if (cursors.up.isDown && player.body.touching.down){
		player.body.velocity.y = -800;//altura do pulo
	}
	for(var i=0; i < contadorIni; i++){//novo 
		if (inimigos.getAt(i)){
			switch (i){
				case 0:
					if (inimigos.getAt(i).body.x>300){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}else if (inimigos.getAt(i).body.x<10){
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}
					break;
				case 1:
					if (inimigos.getAt(i).body.x>720){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}else if (inimigos.getAt(i).body.x<495){
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}
					break;
				case 2:
					if (inimigos.getAt(i).body.x>1300){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}else if (inimigos.getAt(i).body.x<1004){
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}
					break;
				case 3: 
					if (inimigos.getAt(i).body.x>2200){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}else if (inimigos.getAt(i).body.x<1950){
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}
					break;
				case 4:
					if (inimigos.getAt(i).body.x>2520){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}else if (inimigos.getAt(i).body.x<2368){
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}
					break;
					
					//segundo bloco
				case 5:
					if (inimigos.getAt(i).body.x<10){//300
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}else if (inimigos.getAt(i).body.x>300){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}
					break;
				case 6:
					if (inimigos.getAt(i).body.x<495){//720
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}else if (inimigos.getAt(i).body.x>720){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}
					break;
				case 7:
					if (inimigos.getAt(i).body.x<1004){//1300
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}else if (inimigos.getAt(i).body.x>1300){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}
					break;
				case 8: 
					if (inimigos.getAt(i).body.x<1950){//2200
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}else if (inimigos.getAt(i).body.x>2200){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}
					break;
				case 9:
					if (inimigos.getAt(i).body.x<2368){//2520
						inimigos.getAt(i).play('right_ini');
						inimigos.getAt(i).body.velocity.x=60;
					}else if (inimigos.getAt(i).body.x>2520){
						inimigos.getAt(i).play('left_ini');
						inimigos.getAt(i).body.velocity.x=-60;
					}
					break;
				default:
					if (inimigos.getAt(i).body.x<0 || inimigos.getAt(i).body.x> game.world.width-150){
						inimigos.getAt(i).body.x=game.world.randomX;//here
						inimigos.getAt(i).body.y=game.world.randomY;
					}
					break;
				}
		}
	}//end novo
	if (NovoJogo.visible){
		NovoJogo.events.onInputDown.add(restart,this);
	}
	game.physics.overlap(inimigos, player, KillPlayer, null, this); //ARRUMAR DPS!
	game.physics.overlap(chave, player, getChave, null, this);
	game.physics.overlap(inimigos, bullets, KillInimi, null, this);
	game.physics.overlap(player, portas, colidePorta,null, this);

}
/*
function criaPremios(){
	var prem1= portas.create(168, game.world.height - 317, 'porta');
		prem1.immovable=true;
		prem1.visible=false;
		
	var prem2= portas.create(664, game.world.height - 317, 'porta');
		prem2.immovable=true;
		prem2.visible=false;
	
	var prem3= portas.create(1180, game.world.height - 317, 'porta');
		prem3.immovable=true;
		prem3.visible=false;
		
	var prem4= portas.create(2106, game.world.height - 317, 'porta');
		prem4.immovable=true;
		prem4.visible=false;
		
}*/

function colidePorta(player, porta){
	if (cursors.down.isDown && (clickSingle==true)){
		clickSingle=false;
		for (var i=0; i<4; i++){
			if (portas.getAt(i)==porta){
				switch (i){
					case 0:
						if (premio1==false){
							var img= game.add.button(33, 20, 'pote', colidePorta1, this, 2, 1, 0);
							img.fixedToCamera=true;
							img.cameraOffset.x=305;
							img.cameraOffset.y=100;
							img.inputEnabled=true;	
						}
						break;
					case 1:
						if (premio2==false){
							var img= game.add.button(330, 200, 'pote', colidePorta2, this, 2, 1, 0);
							img.fixedToCamera=true;
							img.cameraOffset.x=305;
							img.cameraOffset.y=100;
							img.inputEnabled=true;	
						}
						break;
					case 2:
						if (premio3==false){
							var img= game.add.button(330, 200, 'pote', colidePorta3, this, 2, 1, 0);
							img.fixedToCamera=true;
							img.cameraOffset.x=305;
							img.cameraOffset.y=100;
							img.inputEnabled=true;	
						}
						break;
					case 3:
						if (premio4==false){
							var img= game.add.button(305, 200, 'pote', colidePorta4, this, 2, 1, 0);
							img.fixedToCamera=true;
							img.cameraOffset.x=450;
							img.cameraOffset.y=100;
							img.inputEnabled=true;	
						}
						break;
					
				}
			}
		}
			
	}else{
	//	alert('not click');
	}
	
}
function colidePorta1(a1){
	premio1=true;
	a1.kill();
}
function colidePorta2(a1){
	premio2=true;
	a1.kill();
}
function colidePorta3(a1){
	premio3=true;
	a1.kill();
}
function colidePorta4(a1){
	premio4=true;
	a1.kill();
}

function criaChave(){
	chave=game.add.sprite(200,400,'chave');
	chave.scale.setTo(0.2,0.2);
}

function getChave (chave, player){
	chave.kill();
	pegouChave=true;
}
function KillPlayer(player, inimigo){
	//inimigo.kill();
	criaPlayer_bool=false;
	player.kill();
	NovoJogo.visible = true;
	var x=player.body.x;
	var y=player.body.y;
	morreu= game.add.sprite(x, y+20, 'morreu');
	morreu.body.velocity.y=-155;
	game.input.onTap.addOnce(restart,this);	
}

function KillInimi(inimigo, bullet){
	inimigo.kill();
	bullet.kill();
}

function collectStar (player, star) {
      star.kill();
}

function fireBullet (ponteiroParaTiro) {

    if (game.time.now > bulletTime){
        bullet = bullets.getFirstExists(false);

        if (bullet){
            //  And fire it
            if (ponteiroParaTiro==1){
				bullet.reset(player.x-60, player.y+8);//isso é a salvação! :D
				bullet.body.velocity.x = -400;
            }else if (ponteiroParaTiro==2){
				bullet.reset(player.x+60, player.y+8);//isso é a salvação! :D
				bullet.body.velocity.x = +400;
			}
            bulletTime = game.time.now + 200;
        }
    }
}

function criaPlayer(){
	player = game.add.sprite(20, 1300, 'Jhosua');
	player.anchor.setTo(0.5, 0.5);
    player.body.bounce.y = 0.2;
    player.body.gravity.y = 6;
    player.body.collideWorldBounds = true;
	player.animations.add('left', [0, 1, 2, 3], 10, true);
    player.animations.add('right', [5, 6, 7, 8], 10, true);
	game.camera.follow(player);
}

function resetBullet (bullet) {
    bullet.kill();
}

function criaIni(){
	for (var i1 = 0; i1 < contadorIni; i1++){
			switch (i1){
				case 0:
					var ini = inimigos.create(2,1066-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('right_ini');
					ini.body.velocity.x=60;
					break;
				case 1:
					var ini = inimigos.create(492,325-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('right_ini');
					ini.body.velocity.x=60;
					break;
				case 2:
					var ini = inimigos.create(1004,1249-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('right_ini');
					ini.body.velocity.x=60;
					break;
				case 3:
					var ini = inimigos.create(1900,605-100,'Bar_ini');
					ini.body.gravity.y = 6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('right_ini');
					ini.body.velocity.x=60;
					break;
				case 4:
					var ini = inimigos.create(2378,1249-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('right_ini');
					ini.body.velocity.x=60;
					break;
					
					//segundo bloco
				case 5:
					var ini = inimigos.create(300,1066-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('left_ini');
					ini.body.velocity.x=-60;
					break;
				case 6:
					var ini = inimigos.create(720,325-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('left_ini');
					ini.body.velocity.x=-60;
					break;
				case 7:
					var ini = inimigos.create(1300,1249-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('left_ini');
					ini.body.velocity.x=-60;
					break;
				case 8:
					var ini = inimigos.create(2250,605-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('left_ini');
					ini.body.velocity.x=-60;
					break;
				case 9:
					var ini = inimigos.create(2520,1249-100,'Bar_ini');
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = true;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					ini.play('left_ini');
					ini.body.velocity.x=-60;
					break;
				default:
					var ini = inimigos.create(game.world.randomX,game.world.randomY,'Bar_ini');//here
					ini.body.gravity.y=6;
					ini.body.collideWorldBounds = false;
					ini.animations.add('left_ini', [0, 1], 8, true);
					ini.animations.add('right_ini', [2, 3], 8, true);
					if ((game.world.randomX%2)==0){
						ini.play('left_ini');
						ini.body.velocity.x=-60;
					}else{
						ini.play('right_ini');
						ini.body.velocity.x=60;
					}
					break;
		}
	}
}


function restart () {
 
	morreu.kill();
	inimigos.removeAll();
	criaIni();
	if (criaPlayer_bool==false){
		criaPlayer();
	}
	criaPlayer_bool=true;

	chave.kill();
	criaChave();
	pegouChave=false;

	NovoJogo.visible = false;
	premio1=false;
	premio2=false;
	premio3=false;
	premio4=false;
}




</script>

</body>
</html>